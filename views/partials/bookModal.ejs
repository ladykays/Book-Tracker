<div id="bookModal" class="fixed hidden inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
  <div class="relative top-20 mx-auto p-5 border w-3/4 shadow-lg rounded-md bg-white">
    <div class="flex">
      <!-- left side - book cover -->
      <div class="w-1/3 p-4">
        <img id="modalBookCover" src="" alt="Book cover" class="w-full rounded-lg">
      </div>
      
      <!-- right side - book details -->
      <div class="w-2/3 p-4">
        <h2 id="modalBookTitle" class="text-3xl font-bold mb-2"></h2>
        <p id="modalBookAuthor" class="text-xl text-gray-600 mb-4"></p>
        <div id="modalBookRating" class="mb-4"></div>
        <p id="modalBookNotes" class="text-gray-700 whitespace-pre-line"></p>
      </div>
    </div>
    
    <!-- Close button -->
    <div class="mt-4 flex justify-end">
      <button onclick="closeModal()" class="px-4 py-2 bg-gray-500 text-white text-base font-medium rounded-md shadow-sm hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-300">
        Close
      </button>
    </div>
  </div>
</div>


<script>
  // Wait for DOM to be fully loaded
  document.addEventListener('DOMContentLoaded', function() {
    //Function to render stars
    function renderStars(rating) {
      let stars = "";
      for (let i = 1; i <= 5; i++) {
        stars += i <= rating 
          ? '<i class="bi bi-star-fill text-xl text-amber-400"></i>' 
          : '<i class="bi bi-star text-xl"></i>';
      }
      return stars;
    }

    // Function to open modal
    function openBookModal(book) {
      const modal = document.getElementById('bookModal');
      
      // Populate modal with book data
      document.getElementById('modalBookCover').src = book.cover_url;
      document.getElementById('modalBookTitle').textContent = book.title;
      document.getElementById('modalBookAuthor').textContent = book.author;
      document.getElementById('modalBookNotes').textContent = book.notes;
      
      
      // Render stars - ensure renderStars is available globally
      if (typeof renderStars === 'function') {
        document.getElementById('modalBookRating').innerHTML = renderStars(book.rating);
      }
      
      // Display the modal
      modal.classList.remove('hidden');
      modal.classList.add('block');
    }

    // Function to close modal
    function closeModal() {
      const modal = document.getElementById('bookModal');
      modal.classList.remove('block');
      modal.classList.add('hidden');
    }

    // Event listener for book cards
    document.addEventListener('click', function(e) {
      const card = e.target.closest('[data-book]'); 
      if (card) {
        try {
          const bookData = JSON.parse(card.dataset.book);
          openBookModal(bookData);
        } catch (error) {
          console.error('Error parsing book data:', error);
        }
      }
    });

    // Make functions available globally
    window.openBookModal = openBookModal;
    window.closeModal = closeModal;
  });
</script>